// This file was auto-generated by Fern from our API Definition.

import { FernApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("AlertsV2Client", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new FernApiClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alerts: [
                {
                    alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                    attributes: [
                        {
                            array_value: [
                                {
                                    catalog_entry: {
                                        catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                        name: "Primary On-call",
                                    },
                                    label: "Payments Team",
                                    literal: "SEV123",
                                },
                            ],
                            attribute: {
                                array: false,
                                id: "01GW2G3V0S59R238FAHPDS1R66",
                                name: "service",
                                required: false,
                                type: 'CatalogEntry["01GW2G3V0S59R238FAHPDS1R67"]',
                            },
                            value: {
                                catalog_entry: {
                                    catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Primary On-call",
                                },
                                label: "Payments Team",
                                literal: "SEV123",
                            },
                        },
                    ],
                    created_at: "2021-08-17T13:28:57Z",
                    deduplication_key: "4293868629",
                    description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    resolved_at: "2021-08-17T14:28:57Z",
                    source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                    status: "firing",
                    title: "*errors.withMessage: PG::Error failed to connect",
                    updated_at: "2021-08-17T13:28:57Z",
                },
            ],
            pagination_meta: { after: "01FCNDV6P870EA6S7TK1DSYDG0", page_size: 25 },
        };
        server.mockEndpoint().get("/v2/alerts").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.alertsV2.list({
            page_size: 25,
            after: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual({
            alerts: [
                {
                    alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                    attributes: [
                        {
                            array_value: [
                                {
                                    catalog_entry: {
                                        catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                        name: "Primary On-call",
                                    },
                                    label: "Payments Team",
                                    literal: "SEV123",
                                },
                            ],
                            attribute: {
                                array: false,
                                id: "01GW2G3V0S59R238FAHPDS1R66",
                                name: "service",
                                required: false,
                                type: 'CatalogEntry["01GW2G3V0S59R238FAHPDS1R67"]',
                            },
                            value: {
                                catalog_entry: {
                                    catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Primary On-call",
                                },
                                label: "Payments Team",
                                literal: "SEV123",
                            },
                        },
                    ],
                    created_at: "2021-08-17T13:28:57Z",
                    deduplication_key: "4293868629",
                    description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    resolved_at: "2021-08-17T14:28:57Z",
                    source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                    status: "firing",
                    title: "*errors.withMessage: PG::Error failed to connect",
                    updated_at: "2021-08-17T13:28:57Z",
                },
            ],
            pagination_meta: {
                after: "01FCNDV6P870EA6S7TK1DSYDG0",
                page_size: 25,
            },
        });
    });

    test("show", async () => {
        const server = mockServerPool.createServer();
        const client = new FernApiClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alert: {
                alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                attributes: [
                    {
                        array_value: [
                            {
                                catalog_entry: {
                                    catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Primary On-call",
                                },
                                label: "Payments Team",
                                literal: "SEV123",
                            },
                        ],
                        attribute: {
                            array: false,
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            name: "service",
                            required: false,
                            type: 'CatalogEntry["01GW2G3V0S59R238FAHPDS1R67"]',
                        },
                        value: {
                            catalog_entry: {
                                catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Primary On-call",
                            },
                            label: "Payments Team",
                            literal: "SEV123",
                        },
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                deduplication_key: "4293868629",
                description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                id: "01GW2G3V0S59R238FAHPDS1R66",
                resolved_at: "2021-08-17T14:28:57Z",
                source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                status: "firing",
                title: "*errors.withMessage: PG::Error failed to connect",
                updated_at: "2021-08-17T13:28:57Z",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/alerts/01FDAG4SAP5TYPT98WGR2N7W91")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertsV2.show({
            id: "01FDAG4SAP5TYPT98WGR2N7W91",
        });
        expect(response).toEqual({
            alert: {
                alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                attributes: [
                    {
                        array_value: [
                            {
                                catalog_entry: {
                                    catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Primary On-call",
                                },
                                label: "Payments Team",
                                literal: "SEV123",
                            },
                        ],
                        attribute: {
                            array: false,
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            name: "service",
                            required: false,
                            type: 'CatalogEntry["01GW2G3V0S59R238FAHPDS1R67"]',
                        },
                        value: {
                            catalog_entry: {
                                catalog_type_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Primary On-call",
                            },
                            label: "Payments Team",
                            literal: "SEV123",
                        },
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                deduplication_key: "4293868629",
                description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                id: "01GW2G3V0S59R238FAHPDS1R66",
                resolved_at: "2021-08-17T14:28:57Z",
                source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                status: "firing",
                title: "*errors.withMessage: PG::Error failed to connect",
                updated_at: "2021-08-17T13:28:57Z",
            },
        });
    });

    test("listincidentalerts", async () => {
        const server = mockServerPool.createServer();
        const client = new FernApiClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            incident_alerts: [
                {
                    alert: {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                    alert_route_id: "01GW2G3V0S59R238FAHPDS1R67",
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    incident: {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                },
            ],
            pagination_meta: { after: "01FCNDV6P870EA6S7TK1DSYDG0", page_size: 25 },
        };
        server
            .mockEndpoint()
            .get("/v2/incident_alerts")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertsV2.listincidentalerts({
            page_size: 25,
            after: "01FCNDV6P870EA6S7TK1DSYDG0",
            alert_id: "01FCNDV6P870EA6S7TK1DSYDG1",
            incident_id: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual({
            incident_alerts: [
                {
                    alert: {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                    alert_route_id: "01GW2G3V0S59R238FAHPDS1R67",
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    incident: {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                },
            ],
            pagination_meta: {
                after: "01FCNDV6P870EA6S7TK1DSYDG0",
                page_size: 25,
            },
        });
    });
});

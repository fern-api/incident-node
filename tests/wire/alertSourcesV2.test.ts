// This file was auto-generated by Fern from our API Definition.

import { IncidentIOClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("AlertSourcesV2Client", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alert_sources: [
                {
                    email_options: { email_address: "lawrence@example.com" },
                    http_custom_options: {
                        deduplication_key_path: "$.alert_id",
                        transform_expression:
                            "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                    },
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
                    name: "Production Web Dashboard Alerts",
                    owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                    secret_token: "some-secret-token",
                    source_type: "alertmanager",
                    template: {
                        attributes: [
                            {
                                alert_attribute_id: "abc123",
                                binding: {
                                    array_value: [
                                        { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                        ],
                        description: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        expressions: [
                            {
                                else_branch: {
                                    result: {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                },
                                label: "Team Slack channel",
                                operations: [
                                    {
                                        branches: {
                                            branches: [
                                                {
                                                    condition_groups: [
                                                        {
                                                            conditions: [
                                                                {
                                                                    operation: {
                                                                        label: "Lawrence Jones",
                                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                    },
                                                                    param_bindings: [
                                                                        {
                                                                            array_value: [
                                                                                {
                                                                                    label: "Lawrence Jones",
                                                                                    literal: "SEV123",
                                                                                    reference: "incident.severity",
                                                                                },
                                                                            ],
                                                                            value: {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        },
                                                                    ],
                                                                    subject: {
                                                                        label: "Incident Severity",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                        },
                                                    ],
                                                    result: {
                                                        array_value: [
                                                            {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        ],
                                                        value: {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                },
                                            ],
                                            returns: { array: true, type: "IncidentStatus" },
                                        },
                                        filter: {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                        },
                                        navigate: { reference: "1235", reference_label: "Teams" },
                                        operation_type: "navigate",
                                        parse: {
                                            returns: { array: true, type: "IncidentStatus" },
                                            source: 'metadata.annotations["github.com/repo"]',
                                        },
                                        returns: { array: true, type: "IncidentStatus" },
                                    },
                                ],
                                reference: "abc123",
                                returns: { array: true, type: "IncidentStatus" },
                                root_reference: "incident.status",
                            },
                        ],
                        is_private: false,
                        title: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        visible_to_teams: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                },
            ],
        };
        server.mockEndpoint().get("/v2/alert_sources").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.alertSourcesV2.list();
        expect(response).toEqual({
            alert_sources: [
                {
                    email_options: {
                        email_address: "lawrence@example.com",
                    },
                    http_custom_options: {
                        deduplication_key_path: "$.alert_id",
                        transform_expression:
                            "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                    },
                    id: "01GW2G3V0S59R238FAHPDS1R66",
                    jira_options: {
                        project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
                    },
                    name: "Production Web Dashboard Alerts",
                    owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                    secret_token: "some-secret-token",
                    source_type: "alertmanager",
                    template: {
                        attributes: [
                            {
                                alert_attribute_id: "abc123",
                                binding: {
                                    array_value: [
                                        {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                        ],
                        description: {
                            label: "Lawrence Jones",
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                        expressions: [
                            {
                                else_branch: {
                                    result: {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                },
                                label: "Team Slack channel",
                                operations: [
                                    {
                                        branches: {
                                            branches: [
                                                {
                                                    condition_groups: [
                                                        {
                                                            conditions: [
                                                                {
                                                                    operation: {
                                                                        label: "Lawrence Jones",
                                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                    },
                                                                    param_bindings: [
                                                                        {
                                                                            array_value: [
                                                                                {
                                                                                    label: "Lawrence Jones",
                                                                                    literal: "SEV123",
                                                                                    reference: "incident.severity",
                                                                                },
                                                                            ],
                                                                            value: {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        },
                                                                    ],
                                                                    subject: {
                                                                        label: "Incident Severity",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                        },
                                                    ],
                                                    result: {
                                                        array_value: [
                                                            {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        ],
                                                        value: {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                },
                                            ],
                                            returns: {
                                                array: true,
                                                type: "IncidentStatus",
                                            },
                                        },
                                        filter: {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                        },
                                        navigate: {
                                            reference: "1235",
                                            reference_label: "Teams",
                                        },
                                        operation_type: "navigate",
                                        parse: {
                                            returns: {
                                                array: true,
                                                type: "IncidentStatus",
                                            },
                                            source: 'metadata.annotations["github.com/repo"]',
                                        },
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                    },
                                ],
                                reference: "abc123",
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                                root_reference: "incident.status",
                            },
                        ],
                        is_private: false,
                        title: {
                            label: "Lawrence Jones",
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                        visible_to_teams: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            http_custom_options: {
                deduplication_key_path: "$.alert_id",
                transform_expression:
                    "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
            },
            jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
            name: "Production Web Dashboard Alerts",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            source_type: "alertmanager",
            template: {
                attributes: [
                    {
                        alert_attribute_id: "abc123",
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                ],
                description: { literal: "SEV123", reference: "incident.severity" },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                value: { literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: "one_of",
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: "incident.severity",
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                                value: { literal: "SEV123", reference: "incident.severity" },
                                            },
                                        },
                                    ],
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                                concatenate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: "one_of",
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                { literal: "SEV123", reference: "incident.severity" },
                                                            ],
                                                            value: {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: "incident.severity",
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                                operation_type: "navigate",
                                parse: {
                                    returns: { array: true, type: "IncidentStatus" },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                            },
                        ],
                        reference: "abc123",
                        root_reference: "incident.status",
                    },
                ],
                is_private: false,
                title: { literal: "SEV123", reference: "incident.severity" },
                visible_to_teams: {
                    array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                    value: { literal: "SEV123", reference: "incident.severity" },
                },
            },
        };
        const rawResponseBody = {
            alert_source: {
                email_options: { email_address: "lawrence@example.com" },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                    description: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: { array: true, type: "IncidentStatus" },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: { reference: "1235", reference_label: "Teams" },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: { array: true, type: "IncidentStatus" },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                            ],
                            reference: "abc123",
                            returns: { array: true, type: "IncidentStatus" },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    visible_to_teams: {
                        array_value: [{ label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" }],
                        value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    },
                },
            },
        };
        server
            .mockEndpoint()
            .post("/v2/alert_sources")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertSourcesV2.create({
            http_custom_options: {
                deduplication_key_path: "$.alert_id",
                transform_expression:
                    "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
            },
            jira_options: {
                project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
            },
            name: "Production Web Dashboard Alerts",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            source_type: "alertmanager",
            template: {
                attributes: [
                    {
                        alert_attribute_id: "abc123",
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                ],
                description: {
                    literal: "SEV123",
                    reference: "incident.severity",
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    {
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: "one_of",
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: "incident.severity",
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                                concatenate: {
                                    reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: "one_of",
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: "incident.severity",
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: {
                                    reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                                },
                                operation_type: "navigate",
                                parse: {
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                            },
                        ],
                        reference: "abc123",
                        root_reference: "incident.status",
                    },
                ],
                is_private: false,
                title: {
                    literal: "SEV123",
                    reference: "incident.severity",
                },
                visible_to_teams: {
                    array_value: [
                        {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    ],
                    value: {
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                },
            },
        });
        expect(response).toEqual({
            alert_source: {
                email_options: {
                    email_address: "lawrence@example.com",
                },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: {
                    project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
                },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                    description: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: {
                                        reference: "1235",
                                        reference_label: "Teams",
                                    },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                            ],
                            reference: "abc123",
                            returns: {
                                array: true,
                                type: "IncidentStatus",
                            },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    visible_to_teams: {
                        array_value: [
                            {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            label: "Lawrence Jones",
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
            },
        });
    });

    test("show", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alert_source: {
                email_options: { email_address: "lawrence@example.com" },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                    description: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: { array: true, type: "IncidentStatus" },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: { reference: "1235", reference_label: "Teams" },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: { array: true, type: "IncidentStatus" },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                            ],
                            reference: "abc123",
                            returns: { array: true, type: "IncidentStatus" },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    visible_to_teams: {
                        array_value: [{ label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" }],
                        value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    },
                },
            },
        };
        server
            .mockEndpoint()
            .get("/v2/alert_sources/01GW2G3V0S59R238FAHPDS1R66")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertSourcesV2.show({
            id: "01GW2G3V0S59R238FAHPDS1R66",
        });
        expect(response).toEqual({
            alert_source: {
                email_options: {
                    email_address: "lawrence@example.com",
                },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: {
                    project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
                },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                    description: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: {
                                        reference: "1235",
                                        reference_label: "Teams",
                                    },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                            ],
                            reference: "abc123",
                            returns: {
                                array: true,
                                type: "IncidentStatus",
                            },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    visible_to_teams: {
                        array_value: [
                            {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            label: "Lawrence Jones",
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
            },
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            http_custom_options: {
                deduplication_key_path: "$.alert_id",
                transform_expression:
                    "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
            },
            jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
            name: "Production Web Dashboard Alerts",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            template: {
                attributes: [
                    {
                        alert_attribute_id: "abc123",
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                ],
                description: { literal: "SEV123", reference: "incident.severity" },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                value: { literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: "one_of",
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: "incident.severity",
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                                value: { literal: "SEV123", reference: "incident.severity" },
                                            },
                                        },
                                    ],
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                                concatenate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: "one_of",
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                { literal: "SEV123", reference: "incident.severity" },
                                                            ],
                                                            value: {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: "incident.severity",
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                                operation_type: "navigate",
                                parse: {
                                    returns: { array: true, type: "IncidentStatus" },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                            },
                        ],
                        reference: "abc123",
                        root_reference: "incident.status",
                    },
                ],
                is_private: false,
                title: { literal: "SEV123", reference: "incident.severity" },
                visible_to_teams: {
                    array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                    value: { literal: "SEV123", reference: "incident.severity" },
                },
            },
        };
        const rawResponseBody = {
            alert_source: {
                email_options: { email_address: "lawrence@example.com" },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: { project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"] },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                    description: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: { array: true, type: "IncidentStatus" },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: { reference: "1235", reference_label: "Teams" },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: { array: true, type: "IncidentStatus" },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                            ],
                            reference: "abc123",
                            returns: { array: true, type: "IncidentStatus" },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    visible_to_teams: {
                        array_value: [{ label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" }],
                        value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                    },
                },
            },
        };
        server
            .mockEndpoint()
            .put("/v2/alert_sources/01GW2G3V0S59R238FAHPDS1R66")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertSourcesV2.update({
            id: "01GW2G3V0S59R238FAHPDS1R66",
            http_custom_options: {
                deduplication_key_path: "$.alert_id",
                transform_expression:
                    "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
            },
            jira_options: {
                project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
            },
            name: "Production Web Dashboard Alerts",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            template: {
                attributes: [
                    {
                        alert_attribute_id: "abc123",
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                ],
                description: {
                    literal: "SEV123",
                    reference: "incident.severity",
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    {
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: "one_of",
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: "incident.severity",
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                                concatenate: {
                                    reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: "one_of",
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: "incident.severity",
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: {
                                    reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                                },
                                operation_type: "navigate",
                                parse: {
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                            },
                        ],
                        reference: "abc123",
                        root_reference: "incident.status",
                    },
                ],
                is_private: false,
                title: {
                    literal: "SEV123",
                    reference: "incident.severity",
                },
                visible_to_teams: {
                    array_value: [
                        {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    ],
                    value: {
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                },
            },
        });
        expect(response).toEqual({
            alert_source: {
                email_options: {
                    email_address: "lawrence@example.com",
                },
                http_custom_options: {
                    deduplication_key_path: "$.alert_id",
                    transform_expression:
                        "return {\n  title: $.title || $.name || 'Unknown Alert',\n  status: $.status === 'resolved' ? 'resolved' : 'firing',\n  description: $.description || $.message || '',\n  sourceURL: $.url || $.link || '',\n  metadata: { team: $.team, severity: $.severity }\n}",
                },
                id: "01GW2G3V0S59R238FAHPDS1R66",
                jira_options: {
                    project_ids: ["01GBSQF3FHF7FWZQNWGHAVQ804", "10043"],
                },
                name: "Production Web Dashboard Alerts",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                secret_token: "some-secret-token",
                source_type: "alertmanager",
                template: {
                    attributes: [
                        {
                            alert_attribute_id: "abc123",
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                    description: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    expressions: [
                        {
                            else_branch: {
                                result: {
                                    array_value: [
                                        {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            },
                            label: "Team Slack channel",
                            operations: [
                                {
                                    branches: {
                                        branches: [
                                            {
                                                condition_groups: [
                                                    {
                                                        conditions: [
                                                            {
                                                                operation: {
                                                                    label: "Lawrence Jones",
                                                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                                },
                                                                param_bindings: [
                                                                    {
                                                                        array_value: [
                                                                            {
                                                                                label: "Lawrence Jones",
                                                                                literal: "SEV123",
                                                                                reference: "incident.severity",
                                                                            },
                                                                        ],
                                                                        value: {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    },
                                                                ],
                                                                subject: {
                                                                    label: "Incident Severity",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                    },
                                                ],
                                                result: {
                                                    array_value: [
                                                        {
                                                            label: "Lawrence Jones",
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    ],
                                                    value: {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            },
                                        ],
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                    },
                                    filter: {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: {
                                                            label: "Lawrence Jones",
                                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                        },
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: {
                                                            label: "Incident Severity",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    navigate: {
                                        reference: "1235",
                                        reference_label: "Teams",
                                    },
                                    operation_type: "navigate",
                                    parse: {
                                        returns: {
                                            array: true,
                                            type: "IncidentStatus",
                                        },
                                        source: 'metadata.annotations["github.com/repo"]',
                                    },
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                            ],
                            reference: "abc123",
                            returns: {
                                array: true,
                                type: "IncidentStatus",
                            },
                            root_reference: "incident.status",
                        },
                    ],
                    is_private: false,
                    title: {
                        label: "Lawrence Jones",
                        literal: "SEV123",
                        reference: "incident.severity",
                    },
                    visible_to_teams: {
                        array_value: [
                            {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            label: "Lawrence Jones",
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        server
            .mockEndpoint()
            .delete("/v2/alert_sources/01GW2G3V0S59R238FAHPDS1R66")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.alertSourcesV2.delete({
            id: "01GW2G3V0S59R238FAHPDS1R66",
        });
        expect(response).toEqual(undefined);
    });
});

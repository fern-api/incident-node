// This file was auto-generated by Fern from our API Definition.

import { IncidentIOClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("AlertRoutesV2Client", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alert_routes: [{ enabled: false, id: "01FCNDV6P870EA6S7TK1DSYDG0", name: "Production incidents" }],
            pagination_meta: { after: "01FCNDV6P870EA6S7TK1DSYDG0", page_size: 25 },
        };
        server.mockEndpoint().get("/v2/alert_routes").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.alertRoutesV2.list({
            page_size: 25,
            after: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual({
            alert_routes: [
                {
                    enabled: false,
                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    name: "Production incidents",
                },
            ],
            pagination_meta: {
                after: "01FCNDV6P870EA6S7TK1DSYDG0",
                page_size: 25,
            },
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            alert_sources: [
                {
                    alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                },
            ],
            channel_config: [
                {
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                    ms_teams_targets: {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        channel_visibility: "abc123",
                    },
                    slack_targets: {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        channel_visibility: "abc123",
                    },
                },
            ],
            condition_groups: [
                {
                    conditions: [
                        {
                            operation: "one_of",
                            param_bindings: [
                                {
                                    array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                    value: { literal: "SEV123", reference: "incident.severity" },
                                },
                            ],
                            subject: "incident.severity",
                        },
                    ],
                },
            ],
            created_at: "2021-08-17T13:28:57Z",
            enabled: false,
            escalation_config: {
                auto_cancel_escalations: false,
                escalation_targets: [
                    {
                        escalation_paths: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        users: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                ],
            },
            expressions: [
                {
                    else_branch: {
                        result: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    label: "Team Slack channel",
                    operations: [
                        {
                            branches: {
                                branches: [
                                    {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: "one_of",
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: "incident.severity",
                                                    },
                                                ],
                                            },
                                        ],
                                        result: {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    },
                                ],
                                returns: { array: true, type: "IncidentStatus" },
                            },
                            concatenate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                            filter: {
                                condition_groups: [
                                    {
                                        conditions: [
                                            {
                                                operation: "one_of",
                                                param_bindings: [
                                                    {
                                                        array_value: [
                                                            { literal: "SEV123", reference: "incident.severity" },
                                                        ],
                                                        value: { literal: "SEV123", reference: "incident.severity" },
                                                    },
                                                ],
                                                subject: "incident.severity",
                                            },
                                        ],
                                    },
                                ],
                            },
                            navigate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                            operation_type: "navigate",
                            parse: {
                                returns: { array: true, type: "IncidentStatus" },
                                source: 'metadata.annotations["github.com/repo"]',
                            },
                        },
                    ],
                    reference: "abc123",
                    root_reference: "incident.status",
                },
            ],
            incident_config: {
                auto_decline_enabled: false,
                auto_relate_grouped_alerts: false,
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                        value: { literal: "SEV123", reference: "incident.severity" },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                    },
                ],
                defer_time_seconds: 1,
                enabled: false,
                grouping_keys: [{ reference: "alert.title" }],
                grouping_window_seconds: 1,
            },
            incident_template: {
                custom_fields: [
                    {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        merge_strategy: "first-wins",
                    },
                ],
                incident_mode: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                incident_type: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                name: {
                    autogenerated: false,
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                severity: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                    merge_strategy: "first-wins",
                },
                start_in_triage: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                summary: {
                    autogenerated: false,
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                workspace: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
            },
            is_private: false,
            name: "Production incidents",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            updated_at: "2021-08-17T13:28:57Z",
            version: 1,
        };
        const rawResponseBody = {
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: { label: "Incident Severity", reference: "incident.severity" },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            users: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: { reference: "1235", reference_label: "Teams" },
                                operation_type: "navigate",
                                parse: {
                                    returns: { array: true, type: "IncidentStatus" },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: { array: true, type: "IncidentStatus" },
                            },
                        ],
                        reference: "abc123",
                        returns: { array: true, type: "IncidentStatus" },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [{ reference: "alert.title" }],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        };
        server
            .mockEndpoint()
            .post("/v2/alert_routes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertRoutesV2.create({
            alert_sources: [
                {
                    alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                },
            ],
            channel_config: [
                {
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                    ms_teams_targets: {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        channel_visibility: "abc123",
                    },
                    slack_targets: {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        channel_visibility: "abc123",
                    },
                },
            ],
            condition_groups: [
                {
                    conditions: [
                        {
                            operation: "one_of",
                            param_bindings: [
                                {
                                    array_value: [
                                        {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                            subject: "incident.severity",
                        },
                    ],
                },
            ],
            created_at: "2021-08-17T13:28:57Z",
            enabled: false,
            escalation_config: {
                auto_cancel_escalations: false,
                escalation_targets: [
                    {
                        escalation_paths: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        users: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                ],
            },
            expressions: [
                {
                    else_branch: {
                        result: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    label: "Team Slack channel",
                    operations: [
                        {
                            branches: {
                                branches: [
                                    {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: "one_of",
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: "incident.severity",
                                                    },
                                                ],
                                            },
                                        ],
                                        result: {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    },
                                ],
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                            },
                            concatenate: {
                                reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                            },
                            filter: {
                                condition_groups: [
                                    {
                                        conditions: [
                                            {
                                                operation: "one_of",
                                                param_bindings: [
                                                    {
                                                        array_value: [
                                                            {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        ],
                                                        value: {
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                                subject: "incident.severity",
                                            },
                                        ],
                                    },
                                ],
                            },
                            navigate: {
                                reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                            },
                            operation_type: "navigate",
                            parse: {
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                                source: 'metadata.annotations["github.com/repo"]',
                            },
                        },
                    ],
                    reference: "abc123",
                    root_reference: "incident.status",
                },
            ],
            incident_config: {
                auto_decline_enabled: false,
                auto_relate_grouped_alerts: false,
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                    },
                ],
                defer_time_seconds: 1,
                enabled: false,
                grouping_keys: [
                    {
                        reference: "alert.title",
                    },
                ],
                grouping_window_seconds: 1,
            },
            incident_template: {
                custom_fields: [
                    {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        merge_strategy: "first-wins",
                    },
                ],
                incident_mode: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                incident_type: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                name: {
                    autogenerated: false,
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                severity: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                    merge_strategy: "first-wins",
                },
                start_in_triage: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                summary: {
                    autogenerated: false,
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                workspace: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
            },
            is_private: false,
            name: "Production incidents",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            updated_at: "2021-08-17T13:28:57Z",
            version: 1,
        });
        expect(response).toEqual({
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: {
                                    label: "Lawrence Jones",
                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: {
                                    label: "Incident Severity",
                                    reference: "incident.severity",
                                },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            users: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: {
                                    reference: "1235",
                                    reference_label: "Teams",
                                },
                                operation_type: "navigate",
                                parse: {
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                            },
                        ],
                        reference: "abc123",
                        returns: {
                            array: true,
                            type: "IncidentStatus",
                        },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [
                        {
                            reference: "alert.title",
                        },
                    ],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        });
    });

    test("show", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: { label: "Incident Severity", reference: "incident.severity" },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            users: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: { reference: "1235", reference_label: "Teams" },
                                operation_type: "navigate",
                                parse: {
                                    returns: { array: true, type: "IncidentStatus" },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: { array: true, type: "IncidentStatus" },
                            },
                        ],
                        reference: "abc123",
                        returns: { array: true, type: "IncidentStatus" },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [{ reference: "alert.title" }],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        };
        server
            .mockEndpoint()
            .get("/v2/alert_routes/01FCNDV6P870EA6S7TK1DSYDG0")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertRoutesV2.show({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual({
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: {
                                    label: "Lawrence Jones",
                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: {
                                    label: "Incident Severity",
                                    reference: "incident.severity",
                                },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            users: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: {
                                    reference: "1235",
                                    reference_label: "Teams",
                                },
                                operation_type: "navigate",
                                parse: {
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                            },
                        ],
                        reference: "abc123",
                        returns: {
                            array: true,
                            type: "IncidentStatus",
                        },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [
                        {
                            reference: "alert.title",
                        },
                    ],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            alert_sources: [
                {
                    alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                },
            ],
            channel_config: [
                {
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                    ms_teams_targets: {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        channel_visibility: "abc123",
                    },
                    slack_targets: {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        channel_visibility: "abc123",
                    },
                },
            ],
            condition_groups: [
                {
                    conditions: [
                        {
                            operation: "one_of",
                            param_bindings: [
                                {
                                    array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                    value: { literal: "SEV123", reference: "incident.severity" },
                                },
                            ],
                            subject: "incident.severity",
                        },
                    ],
                },
            ],
            created_at: "2021-08-17T13:28:57Z",
            enabled: false,
            escalation_config: {
                auto_cancel_escalations: false,
                escalation_targets: [
                    {
                        escalation_paths: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        users: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                ],
            },
            expressions: [
                {
                    else_branch: {
                        result: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    label: "Team Slack channel",
                    operations: [
                        {
                            branches: {
                                branches: [
                                    {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: "one_of",
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: "incident.severity",
                                                    },
                                                ],
                                            },
                                        ],
                                        result: {
                                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                            value: { literal: "SEV123", reference: "incident.severity" },
                                        },
                                    },
                                ],
                                returns: { array: true, type: "IncidentStatus" },
                            },
                            concatenate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                            filter: {
                                condition_groups: [
                                    {
                                        conditions: [
                                            {
                                                operation: "one_of",
                                                param_bindings: [
                                                    {
                                                        array_value: [
                                                            { literal: "SEV123", reference: "incident.severity" },
                                                        ],
                                                        value: { literal: "SEV123", reference: "incident.severity" },
                                                    },
                                                ],
                                                subject: "incident.severity",
                                            },
                                        ],
                                    },
                                ],
                            },
                            navigate: { reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]' },
                            operation_type: "navigate",
                            parse: {
                                returns: { array: true, type: "IncidentStatus" },
                                source: 'metadata.annotations["github.com/repo"]',
                            },
                        },
                    ],
                    reference: "abc123",
                    root_reference: "incident.status",
                },
            ],
            incident_config: {
                auto_decline_enabled: false,
                auto_relate_grouped_alerts: false,
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                        value: { literal: "SEV123", reference: "incident.severity" },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                    },
                ],
                defer_time_seconds: 1,
                enabled: false,
                grouping_keys: [{ reference: "alert.title" }],
                grouping_window_seconds: 1,
            },
            incident_template: {
                custom_fields: [
                    {
                        binding: {
                            array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                            value: { literal: "SEV123", reference: "incident.severity" },
                        },
                        custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        merge_strategy: "first-wins",
                    },
                ],
                incident_mode: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                incident_type: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                name: {
                    autogenerated: false,
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                severity: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                    merge_strategy: "first-wins",
                },
                start_in_triage: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                summary: {
                    autogenerated: false,
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
                workspace: {
                    binding: {
                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                        value: { literal: "SEV123", reference: "incident.severity" },
                    },
                },
            },
            is_private: false,
            name: "Production incidents",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            updated_at: "2021-08-17T13:28:57Z",
            version: 1,
        };
        const rawResponseBody = {
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: { label: "Incident Severity", reference: "incident.severity" },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: { label: "Incident Severity", reference: "incident.severity" },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            users: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: { array: true, type: "IncidentStatus" },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: { reference: "1235", reference_label: "Teams" },
                                operation_type: "navigate",
                                parse: {
                                    returns: { array: true, type: "IncidentStatus" },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: { array: true, type: "IncidentStatus" },
                            },
                        ],
                        reference: "abc123",
                        returns: { array: true, type: "IncidentStatus" },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [{ reference: "alert.title" }],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                                ],
                                value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                            ],
                            value: { label: "Lawrence Jones", literal: "SEV123", reference: "incident.severity" },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        };
        server
            .mockEndpoint()
            .put("/v2/alert_routes/01FCNDV6P870EA6S7TK1DSYDG0")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.alertRoutesV2.update({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
            alert_sources: [
                {
                    alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                },
            ],
            channel_config: [
                {
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: "one_of",
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: "incident.severity",
                                },
                            ],
                        },
                    ],
                    ms_teams_targets: {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        channel_visibility: "abc123",
                    },
                    slack_targets: {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        channel_visibility: "abc123",
                    },
                },
            ],
            condition_groups: [
                {
                    conditions: [
                        {
                            operation: "one_of",
                            param_bindings: [
                                {
                                    array_value: [
                                        {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    ],
                                    value: {
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                            subject: "incident.severity",
                        },
                    ],
                },
            ],
            created_at: "2021-08-17T13:28:57Z",
            enabled: false,
            escalation_config: {
                auto_cancel_escalations: false,
                escalation_targets: [
                    {
                        escalation_paths: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        users: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                ],
            },
            expressions: [
                {
                    else_branch: {
                        result: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    label: "Team Slack channel",
                    operations: [
                        {
                            branches: {
                                branches: [
                                    {
                                        condition_groups: [
                                            {
                                                conditions: [
                                                    {
                                                        operation: "one_of",
                                                        param_bindings: [
                                                            {
                                                                array_value: [
                                                                    {
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                ],
                                                                value: {
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            },
                                                        ],
                                                        subject: "incident.severity",
                                                    },
                                                ],
                                            },
                                        ],
                                        result: {
                                            array_value: [
                                                {
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    },
                                ],
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                            },
                            concatenate: {
                                reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                            },
                            filter: {
                                condition_groups: [
                                    {
                                        conditions: [
                                            {
                                                operation: "one_of",
                                                param_bindings: [
                                                    {
                                                        array_value: [
                                                            {
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        ],
                                                        value: {
                                                            literal: "SEV123",
                                                            reference: "incident.severity",
                                                        },
                                                    },
                                                ],
                                                subject: "incident.severity",
                                            },
                                        ],
                                    },
                                ],
                            },
                            navigate: {
                                reference: 'catalog_attribute["01FCNDV6P870EA6S7TK1DSYD5H"]',
                            },
                            operation_type: "navigate",
                            parse: {
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                                source: 'metadata.annotations["github.com/repo"]',
                            },
                        },
                    ],
                    reference: "abc123",
                    root_reference: "incident.status",
                },
            ],
            incident_config: {
                auto_decline_enabled: false,
                auto_relate_grouped_alerts: false,
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                    },
                ],
                defer_time_seconds: 1,
                enabled: false,
                grouping_keys: [
                    {
                        reference: "alert.title",
                    },
                ],
                grouping_window_seconds: 1,
            },
            incident_template: {
                custom_fields: [
                    {
                        binding: {
                            array_value: [
                                {
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        merge_strategy: "first-wins",
                    },
                ],
                incident_mode: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                incident_type: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                name: {
                    autogenerated: false,
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                severity: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                    merge_strategy: "first-wins",
                },
                start_in_triage: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                summary: {
                    autogenerated: false,
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
                workspace: {
                    binding: {
                        array_value: [
                            {
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        ],
                        value: {
                            literal: "SEV123",
                            reference: "incident.severity",
                        },
                    },
                },
            },
            is_private: false,
            name: "Production incidents",
            owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
            updated_at: "2021-08-17T13:28:57Z",
            version: 1,
        });
        expect(response).toEqual({
            alert_route: {
                alert_sources: [
                    {
                        alert_source_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                    },
                ],
                channel_config: [
                    {
                        condition_groups: [
                            {
                                conditions: [
                                    {
                                        operation: {
                                            label: "Lawrence Jones",
                                            value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                        },
                                        param_bindings: [
                                            {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        ],
                                        subject: {
                                            label: "Incident Severity",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                            },
                        ],
                        ms_teams_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                        slack_targets: {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            channel_visibility: "abc123",
                        },
                    },
                ],
                condition_groups: [
                    {
                        conditions: [
                            {
                                operation: {
                                    label: "Lawrence Jones",
                                    value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                },
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            label: "Lawrence Jones",
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: {
                                    label: "Incident Severity",
                                    reference: "incident.severity",
                                },
                            },
                        ],
                    },
                ],
                created_at: "2021-08-17T13:28:57Z",
                enabled: false,
                escalation_config: {
                    auto_cancel_escalations: false,
                    escalation_targets: [
                        {
                            escalation_paths: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            users: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                    ],
                },
                expressions: [
                    {
                        else_branch: {
                            result: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                        },
                        label: "Team Slack channel",
                        operations: [
                            {
                                branches: {
                                    branches: [
                                        {
                                            condition_groups: [
                                                {
                                                    conditions: [
                                                        {
                                                            operation: {
                                                                label: "Lawrence Jones",
                                                                value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                            },
                                                            param_bindings: [
                                                                {
                                                                    array_value: [
                                                                        {
                                                                            label: "Lawrence Jones",
                                                                            literal: "SEV123",
                                                                            reference: "incident.severity",
                                                                        },
                                                                    ],
                                                                    value: {
                                                                        label: "Lawrence Jones",
                                                                        literal: "SEV123",
                                                                        reference: "incident.severity",
                                                                    },
                                                                },
                                                            ],
                                                            subject: {
                                                                label: "Incident Severity",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                },
                                            ],
                                            result: {
                                                array_value: [
                                                    {
                                                        label: "Lawrence Jones",
                                                        literal: "SEV123",
                                                        reference: "incident.severity",
                                                    },
                                                ],
                                                value: {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            },
                                        },
                                    ],
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                },
                                filter: {
                                    condition_groups: [
                                        {
                                            conditions: [
                                                {
                                                    operation: {
                                                        label: "Lawrence Jones",
                                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                                    },
                                                    param_bindings: [
                                                        {
                                                            array_value: [
                                                                {
                                                                    label: "Lawrence Jones",
                                                                    literal: "SEV123",
                                                                    reference: "incident.severity",
                                                                },
                                                            ],
                                                            value: {
                                                                label: "Lawrence Jones",
                                                                literal: "SEV123",
                                                                reference: "incident.severity",
                                                            },
                                                        },
                                                    ],
                                                    subject: {
                                                        label: "Incident Severity",
                                                        reference: "incident.severity",
                                                    },
                                                },
                                            ],
                                        },
                                    ],
                                },
                                navigate: {
                                    reference: "1235",
                                    reference_label: "Teams",
                                },
                                operation_type: "navigate",
                                parse: {
                                    returns: {
                                        array: true,
                                        type: "IncidentStatus",
                                    },
                                    source: 'metadata.annotations["github.com/repo"]',
                                },
                                returns: {
                                    array: true,
                                    type: "IncidentStatus",
                                },
                            },
                        ],
                        reference: "abc123",
                        returns: {
                            array: true,
                            type: "IncidentStatus",
                        },
                        root_reference: "incident.status",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                incident_config: {
                    auto_decline_enabled: false,
                    auto_relate_grouped_alerts: false,
                    condition_groups: [
                        {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                        },
                    ],
                    defer_time_seconds: 1,
                    enabled: false,
                    grouping_keys: [
                        {
                            reference: "alert.title",
                        },
                    ],
                    grouping_window_seconds: 1,
                },
                incident_template: {
                    custom_fields: [
                        {
                            binding: {
                                array_value: [
                                    {
                                        label: "Lawrence Jones",
                                        literal: "SEV123",
                                        reference: "incident.severity",
                                    },
                                ],
                                value: {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            },
                            custom_field_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            merge_strategy: "first-wins",
                        },
                    ],
                    incident_mode: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    incident_type: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    name: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    severity: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                        merge_strategy: "first-wins",
                    },
                    start_in_triage: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    summary: {
                        autogenerated: false,
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                    workspace: {
                        binding: {
                            array_value: [
                                {
                                    label: "Lawrence Jones",
                                    literal: "SEV123",
                                    reference: "incident.severity",
                                },
                            ],
                            value: {
                                label: "Lawrence Jones",
                                literal: "SEV123",
                                reference: "incident.severity",
                            },
                        },
                    },
                },
                is_private: false,
                name: "Production incidents",
                owning_team_ids: ["01G0J1EXE7AXZ2C93K61WBPYEH"],
                updated_at: "2021-08-17T13:28:57Z",
                version: 1,
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        server
            .mockEndpoint()
            .delete("/v2/alert_routes/01FCNDV6P870EA6S7TK1DSYDG0")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.alertRoutesV2.delete({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual(undefined);
    });
});

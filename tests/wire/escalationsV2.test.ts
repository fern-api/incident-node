// This file was auto-generated by Fern from our API Definition.

import { IncidentIOClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("EscalationsV2Client", () => {
    test("createpath", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            name: "Urgent Support",
            path: [
                {
                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    if_else: {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                        value: { literal: "SEV123", reference: "incident.severity" },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                        else_path: [],
                        then_path: [],
                    },
                    level: {
                        ack_mode: "all",
                        round_robin_config: { enabled: false, rotate_after_seconds: 120 },
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    notify_channel: {
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    repeat: { repeat_times: 3, to_node: "01FCNDV6P870EA6S7TK1DSYDG0" },
                    type: "if_else",
                },
            ],
            team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
            working_hours: [
                {
                    id: "abc123",
                    name: "abc123",
                    timezone: "abc123",
                    weekday_intervals: [{ end_time: "17:00", start_time: "09:00", weekday: "monday" }],
                },
            ],
        };
        const rawResponseBody = {
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: { enabled: false, rotate_after_seconds: 120 },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: { repeat_times: 3, to_node: "01FCNDV6P870EA6S7TK1DSYDG0" },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [{ end_time: "17:00", start_time: "09:00", weekday: "monday" }],
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .post("/v2/escalation_paths")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.escalationsV2.createpath({
            name: "Urgent Support",
            path: [
                {
                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    if_else: {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                        else_path: [],
                        then_path: [],
                    },
                    level: {
                        ack_mode: "all",
                        round_robin_config: {
                            enabled: false,
                            rotate_after_seconds: 120,
                        },
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    notify_channel: {
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    repeat: {
                        repeat_times: 3,
                        to_node: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    type: "if_else",
                },
            ],
            team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
            working_hours: [
                {
                    id: "abc123",
                    name: "abc123",
                    timezone: "abc123",
                    weekday_intervals: [
                        {
                            end_time: "17:00",
                            start_time: "09:00",
                            weekday: "monday",
                        },
                    ],
                },
            ],
        });
        expect(response).toEqual({
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: {
                                enabled: false,
                                rotate_after_seconds: 120,
                            },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: {
                            repeat_times: 3,
                            to_node: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [
                            {
                                end_time: "17:00",
                                start_time: "09:00",
                                weekday: "monday",
                            },
                        ],
                    },
                ],
            },
        });
    });

    test("showpath", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: { enabled: false, rotate_after_seconds: 120 },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: { repeat_times: 3, to_node: "01FCNDV6P870EA6S7TK1DSYDG0" },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [{ end_time: "17:00", start_time: "09:00", weekday: "monday" }],
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .get("/v2/escalation_paths/01FCNDV6P870EA6S7TK1DSYDG0")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.escalationsV2.showpath({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual({
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: {
                                enabled: false,
                                rotate_after_seconds: 120,
                            },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: {
                            repeat_times: 3,
                            to_node: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [
                            {
                                end_time: "17:00",
                                start_time: "09:00",
                                weekday: "monday",
                            },
                        ],
                    },
                ],
            },
        });
    });

    test("updatepath", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            name: "Urgent Support",
            path: [
                {
                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    if_else: {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [{ literal: "SEV123", reference: "incident.severity" }],
                                        value: { literal: "SEV123", reference: "incident.severity" },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                        else_path: [],
                        then_path: [],
                    },
                    level: {
                        ack_mode: "all",
                        round_robin_config: { enabled: false, rotate_after_seconds: 120 },
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    notify_channel: {
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    repeat: { repeat_times: 3, to_node: "01FCNDV6P870EA6S7TK1DSYDG0" },
                    type: "if_else",
                },
            ],
            team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
            working_hours: [
                {
                    id: "abc123",
                    name: "abc123",
                    timezone: "abc123",
                    weekday_intervals: [{ end_time: "17:00", start_time: "09:00", weekday: "monday" }],
                },
            ],
        };
        const rawResponseBody = {
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: { label: "Lawrence Jones", value: "01FCQSP07Z74QMMYPDDGQB9FTG" },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: { label: "Incident Severity", reference: "incident.severity" },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: { enabled: false, rotate_after_seconds: 120 },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: { repeat_times: 3, to_node: "01FCNDV6P870EA6S7TK1DSYDG0" },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [{ end_time: "17:00", start_time: "09:00", weekday: "monday" }],
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .put("/v2/escalation_paths/01FCNDV6P870EA6S7TK1DSYDG0")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.escalationsV2.updatepath({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
            name: "Urgent Support",
            path: [
                {
                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    if_else: {
                        conditions: [
                            {
                                operation: "one_of",
                                param_bindings: [
                                    {
                                        array_value: [
                                            {
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        ],
                                        value: {
                                            literal: "SEV123",
                                            reference: "incident.severity",
                                        },
                                    },
                                ],
                                subject: "incident.severity",
                            },
                        ],
                        else_path: [],
                        then_path: [],
                    },
                    level: {
                        ack_mode: "all",
                        round_robin_config: {
                            enabled: false,
                            rotate_after_seconds: 120,
                        },
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    notify_channel: {
                        targets: [
                            {
                                id: "lawrencejones",
                                schedule_mode: "currently_on_call",
                                type: "schedule",
                                urgency: "high",
                            },
                        ],
                        time_to_ack_interval_condition: "active",
                        time_to_ack_seconds: 1800,
                        time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    repeat: {
                        repeat_times: 3,
                        to_node: "01FCNDV6P870EA6S7TK1DSYDG0",
                    },
                    type: "if_else",
                },
            ],
            team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
            working_hours: [
                {
                    id: "abc123",
                    name: "abc123",
                    timezone: "abc123",
                    weekday_intervals: [
                        {
                            end_time: "17:00",
                            start_time: "09:00",
                            weekday: "monday",
                        },
                    ],
                },
            ],
        });
        expect(response).toEqual({
            escalation_path: {
                current_responders: [
                    {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                ],
                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                name: "Urgent Support",
                path: [
                    {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        if_else: {
                            conditions: [
                                {
                                    operation: {
                                        label: "Lawrence Jones",
                                        value: "01FCQSP07Z74QMMYPDDGQB9FTG",
                                    },
                                    param_bindings: [
                                        {
                                            array_value: [
                                                {
                                                    label: "Lawrence Jones",
                                                    literal: "SEV123",
                                                    reference: "incident.severity",
                                                },
                                            ],
                                            value: {
                                                label: "Lawrence Jones",
                                                literal: "SEV123",
                                                reference: "incident.severity",
                                            },
                                        },
                                    ],
                                    subject: {
                                        label: "Incident Severity",
                                        reference: "incident.severity",
                                    },
                                },
                            ],
                            else_path: [],
                            then_path: [],
                        },
                        level: {
                            ack_mode: "all",
                            round_robin_config: {
                                enabled: false,
                                rotate_after_seconds: 120,
                            },
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        notify_channel: {
                            targets: [
                                {
                                    id: "lawrencejones",
                                    schedule_mode: "currently_on_call",
                                    type: "schedule",
                                    urgency: "high",
                                },
                            ],
                            time_to_ack_interval_condition: "active",
                            time_to_ack_seconds: 1800,
                            time_to_ack_weekday_interval_config_id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        repeat: {
                            repeat_times: 3,
                            to_node: "01FCNDV6P870EA6S7TK1DSYDG0",
                        },
                        type: "if_else",
                    },
                ],
                team_ids: ["01JPQA75EPNEES4479P16P4XAB"],
                working_hours: [
                    {
                        id: "abc123",
                        name: "abc123",
                        timezone: "abc123",
                        weekday_intervals: [
                            {
                                end_time: "17:00",
                                start_time: "09:00",
                                weekday: "monday",
                            },
                        ],
                    },
                ],
            },
        });
    });

    test("destroypath", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        server
            .mockEndpoint()
            .delete("/v2/escalation_paths/01FCNDV6P870EA6S7TK1DSYDG0")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.escalationsV2.destroypath({
            id: "01FCNDV6P870EA6S7TK1DSYDG0",
        });
        expect(response).toEqual(undefined);
    });

    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            escalations: [
                {
                    created_at: "2021-08-17T13:28:57Z",
                    creator: {
                        alert: {
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            title: "*errors.withMessage: PG::Error failed to connect",
                        },
                        user: {
                            email: "lisa@incident.io",
                            id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            name: "Lisa Karlin Curtis",
                            role: "viewer",
                            slack_user_id: "U02AYNF2XJM",
                        },
                        workflow: { id: "01FCNDV6P870EA6S7TK1DSYDG0", name: "My little workflow" },
                    },
                    escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                    events: [
                        {
                            channels: [
                                {
                                    microsoft_teams_channel_id: "abc123",
                                    microsoft_teams_team_id: "abc123",
                                    slack_channel_id: "abc123",
                                    slack_team_id: "abc123",
                                },
                            ],
                            event: "entered_grace_period",
                            id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                            occurred_at: "2021-08-17T13:28:57Z",
                            urgency: "high",
                            users: [
                                {
                                    email: "lisa@incident.io",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Lisa Karlin Curtis",
                                    role: "viewer",
                                    slack_user_id: "U02AYNF2XJM",
                                },
                            ],
                        },
                    ],
                    id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                    priority: { name: "P1" },
                    related_alerts: [
                        {
                            alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                            created_at: "2021-08-17T13:28:57Z",
                            deduplication_key: "4293868629",
                            description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            resolved_at: "2021-08-17T14:28:57Z",
                            source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                            status: "firing",
                            title: "*errors.withMessage: PG::Error failed to connect",
                            updated_at: "2021-08-17T13:28:57Z",
                        },
                    ],
                    related_incidents: [
                        {
                            external_id: 123,
                            id: "01FDAG4SAP5TYPT98WGR2N7W91",
                            name: "Our database is sad",
                            reference: "INC-123",
                            status_category: "triage",
                            summary: "Our database is really really sad, and we don't know why yet.",
                            visibility: "public",
                        },
                    ],
                    status: "pending",
                    title: "Database CPU is high",
                    updated_at: "2021-08-17T13:28:57Z",
                },
            ],
            pagination_meta: { after: "01FCNDV6P870EA6S7TK1DSYDG0", page_size: 25 },
        };
        server.mockEndpoint().get("/v2/escalations").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.escalationsV2.list({
            page_size: 25,
            after: "01FDAG4SAP5TYPT98WGR2N7W91",
        });
        expect(response).toEqual({
            escalations: [
                {
                    created_at: "2021-08-17T13:28:57Z",
                    creator: {
                        alert: {
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            title: "*errors.withMessage: PG::Error failed to connect",
                        },
                        user: {
                            email: "lisa@incident.io",
                            id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            name: "Lisa Karlin Curtis",
                            role: "viewer",
                            slack_user_id: "U02AYNF2XJM",
                        },
                        workflow: {
                            id: "01FCNDV6P870EA6S7TK1DSYDG0",
                            name: "My little workflow",
                        },
                    },
                    escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                    events: [
                        {
                            channels: [
                                {
                                    microsoft_teams_channel_id: "abc123",
                                    microsoft_teams_team_id: "abc123",
                                    slack_channel_id: "abc123",
                                    slack_team_id: "abc123",
                                },
                            ],
                            event: "entered_grace_period",
                            id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                            occurred_at: "2021-08-17T13:28:57Z",
                            urgency: "high",
                            users: [
                                {
                                    email: "lisa@incident.io",
                                    id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                    name: "Lisa Karlin Curtis",
                                    role: "viewer",
                                    slack_user_id: "U02AYNF2XJM",
                                },
                            ],
                        },
                    ],
                    id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                    priority: {
                        name: "P1",
                    },
                    related_alerts: [
                        {
                            alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                            created_at: "2021-08-17T13:28:57Z",
                            deduplication_key: "4293868629",
                            description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                            id: "01GW2G3V0S59R238FAHPDS1R66",
                            resolved_at: "2021-08-17T14:28:57Z",
                            source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                            status: "firing",
                            title: "*errors.withMessage: PG::Error failed to connect",
                            updated_at: "2021-08-17T13:28:57Z",
                        },
                    ],
                    related_incidents: [
                        {
                            external_id: 123,
                            id: "01FDAG4SAP5TYPT98WGR2N7W91",
                            name: "Our database is sad",
                            reference: "INC-123",
                            status_category: "triage",
                            summary: "Our database is really really sad, and we don't know why yet.",
                            visibility: "public",
                        },
                    ],
                    status: "pending",
                    title: "Database CPU is high",
                    updated_at: "2021-08-17T13:28:57Z",
                },
            ],
            pagination_meta: {
                after: "01FCNDV6P870EA6S7TK1DSYDG0",
                page_size: 25,
            },
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });
        const rawRequestBody = {
            description: "Database CPU has been above 90% for 5 minutes",
            escalation_path_id: "01H0J1EXE7AXZ2C93K61WBPYEH",
            idempotency_key: "2024-01-15-abc123",
            title: "Production database experiencing high CPU",
            user_ids: ["01H0J1EXE7AXZ2C93K61WBPYEH", "01H0J1EXE7AXZ2C93K61WBPYEI"],
        };
        const rawResponseBody = {
            escalation: {
                created_at: "2021-08-17T13:28:57Z",
                creator: {
                    alert: {
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        title: "*errors.withMessage: PG::Error failed to connect",
                    },
                    user: {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                    workflow: { id: "01FCNDV6P870EA6S7TK1DSYDG0", name: "My little workflow" },
                },
                escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                events: [
                    {
                        channels: [
                            {
                                microsoft_teams_channel_id: "abc123",
                                microsoft_teams_team_id: "abc123",
                                slack_channel_id: "abc123",
                                slack_team_id: "abc123",
                            },
                        ],
                        event: "entered_grace_period",
                        id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                        occurred_at: "2021-08-17T13:28:57Z",
                        urgency: "high",
                        users: [
                            {
                                email: "lisa@incident.io",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Lisa Karlin Curtis",
                                role: "viewer",
                                slack_user_id: "U02AYNF2XJM",
                            },
                        ],
                    },
                ],
                id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                priority: { name: "P1" },
                related_alerts: [
                    {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                ],
                related_incidents: [
                    {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                ],
                status: "pending",
                title: "Database CPU is high",
                updated_at: "2021-08-17T13:28:57Z",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/escalations")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.escalationsV2.create({
            description: "Database CPU has been above 90% for 5 minutes",
            escalation_path_id: "01H0J1EXE7AXZ2C93K61WBPYEH",
            idempotency_key: "2024-01-15-abc123",
            title: "Production database experiencing high CPU",
            user_ids: ["01H0J1EXE7AXZ2C93K61WBPYEH", "01H0J1EXE7AXZ2C93K61WBPYEI"],
        });
        expect(response).toEqual({
            escalation: {
                created_at: "2021-08-17T13:28:57Z",
                creator: {
                    alert: {
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        title: "*errors.withMessage: PG::Error failed to connect",
                    },
                    user: {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                    workflow: {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "My little workflow",
                    },
                },
                escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                events: [
                    {
                        channels: [
                            {
                                microsoft_teams_channel_id: "abc123",
                                microsoft_teams_team_id: "abc123",
                                slack_channel_id: "abc123",
                                slack_team_id: "abc123",
                            },
                        ],
                        event: "entered_grace_period",
                        id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                        occurred_at: "2021-08-17T13:28:57Z",
                        urgency: "high",
                        users: [
                            {
                                email: "lisa@incident.io",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Lisa Karlin Curtis",
                                role: "viewer",
                                slack_user_id: "U02AYNF2XJM",
                            },
                        ],
                    },
                ],
                id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                priority: {
                    name: "P1",
                },
                related_alerts: [
                    {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                ],
                related_incidents: [
                    {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                ],
                status: "pending",
                title: "Database CPU is high",
                updated_at: "2021-08-17T13:28:57Z",
            },
        });
    });

    test("show", async () => {
        const server = mockServerPool.createServer();
        const client = new IncidentIOClient({ maxRetries: 0, environment: server.baseUrl });

        const rawResponseBody = {
            escalation: {
                created_at: "2021-08-17T13:28:57Z",
                creator: {
                    alert: {
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        title: "*errors.withMessage: PG::Error failed to connect",
                    },
                    user: {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                    workflow: { id: "01FCNDV6P870EA6S7TK1DSYDG0", name: "My little workflow" },
                },
                escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                events: [
                    {
                        channels: [
                            {
                                microsoft_teams_channel_id: "abc123",
                                microsoft_teams_team_id: "abc123",
                                slack_channel_id: "abc123",
                                slack_team_id: "abc123",
                            },
                        ],
                        event: "entered_grace_period",
                        id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                        occurred_at: "2021-08-17T13:28:57Z",
                        urgency: "high",
                        users: [
                            {
                                email: "lisa@incident.io",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Lisa Karlin Curtis",
                                role: "viewer",
                                slack_user_id: "U02AYNF2XJM",
                            },
                        ],
                    },
                ],
                id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                priority: { name: "P1" },
                related_alerts: [
                    {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                ],
                related_incidents: [
                    {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                ],
                status: "pending",
                title: "Database CPU is high",
                updated_at: "2021-08-17T13:28:57Z",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/escalations/01G0J1EXE7AXZ2C93K61WBPYEH")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.escalationsV2.show({
            id: "01G0J1EXE7AXZ2C93K61WBPYEH",
        });
        expect(response).toEqual({
            escalation: {
                created_at: "2021-08-17T13:28:57Z",
                creator: {
                    alert: {
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        title: "*errors.withMessage: PG::Error failed to connect",
                    },
                    user: {
                        email: "lisa@incident.io",
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "Lisa Karlin Curtis",
                        role: "viewer",
                        slack_user_id: "U02AYNF2XJM",
                    },
                    workflow: {
                        id: "01FCNDV6P870EA6S7TK1DSYDG0",
                        name: "My little workflow",
                    },
                },
                escalation_path_id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                events: [
                    {
                        channels: [
                            {
                                microsoft_teams_channel_id: "abc123",
                                microsoft_teams_team_id: "abc123",
                                slack_channel_id: "abc123",
                                slack_team_id: "abc123",
                            },
                        ],
                        event: "entered_grace_period",
                        id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                        occurred_at: "2021-08-17T13:28:57Z",
                        urgency: "high",
                        users: [
                            {
                                email: "lisa@incident.io",
                                id: "01FCNDV6P870EA6S7TK1DSYDG0",
                                name: "Lisa Karlin Curtis",
                                role: "viewer",
                                slack_user_id: "U02AYNF2XJM",
                            },
                        ],
                    },
                ],
                id: "01G0J1EXE7AXZ2C93K61WBPYEH",
                priority: {
                    name: "P1",
                },
                related_alerts: [
                    {
                        alert_source_id: "01GW2G3V0S59R238FAHPDS1R66",
                        created_at: "2021-08-17T13:28:57Z",
                        deduplication_key: "4293868629",
                        description: "CPU on the payments service has exceeded 75 percent for 5 minutes",
                        id: "01GW2G3V0S59R238FAHPDS1R66",
                        resolved_at: "2021-08-17T14:28:57Z",
                        source_url: "https://www.my-alerting-platform.com/alerts/my-alert-123",
                        status: "firing",
                        title: "*errors.withMessage: PG::Error failed to connect",
                        updated_at: "2021-08-17T13:28:57Z",
                    },
                ],
                related_incidents: [
                    {
                        external_id: 123,
                        id: "01FDAG4SAP5TYPT98WGR2N7W91",
                        name: "Our database is sad",
                        reference: "INC-123",
                        status_category: "triage",
                        summary: "Our database is really really sad, and we don't know why yet.",
                        visibility: "public",
                    },
                ],
                status: "pending",
                title: "Database CPU is high",
                updated_at: "2021-08-17T13:28:57Z",
            },
        });
    });
});
